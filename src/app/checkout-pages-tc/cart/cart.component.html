<section>
    <div class="banner">
        <h3>完成以下步驟確認訂單</h3>
        <ul>
            <li class="step active">
                <div>
                    <a>購物車</a>
                </div>
            </li>
            <li class="step">
                <div>
                    <a>結算</a>
                </div>
            </li>
            <li class="step ">
                <div>
                    <a>確認訂單</a>
                </div>
            </li>
        </ul>
    </div>
    <div class="body">
        <ng-container *ngIf="items.length>0; else noItems">
            <div class="body-flex">
                <div class="body-left" [ngClass]="{'full': logined}">
                    <h3>購物車 <span>({{items.length}} 產品)</span></h3>
                    <div class="tbl-header">
                        <table cellpadding="0" cellspacing="0" border="0">
                            <thead>
                                <tr>
                                    <th>產品</th>
                                    <th>價格</th>
                                    <th>數量.</th>
                                    <th>小計</th>
                                    <th></th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                    <div class="tbl-content">
                        <table cellpadding="0" cellspacing="0" border="0">
                            <tbody>
                                <ng-container>
                                    <tr *ngFor="let item of items">
                                        <td>
                                            <div>
                                                <a [routerLink]="['/tc/products',item.product.sku]">
                                                    <img alt="" onerror="this.src='assets/images/icon.png'" src="https://www.enjoybag.com.hk/photo/{{item.product.sku}}_1_s.jpg">
                                                </a>
                                                <div>
                                                    <p>{{item.product.name}}</p>
                                                    <span>顏色: {{item.product.color}}</span>
                                                    <span *ngIf="item.product.stock<6">Stock: {{item.product.stock}}</span>
                                                    <span>產品號: {{item.product.sku}}</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <p [ngClass]="{'del': item.product.dis>0}">{{item.product.price | currency:userCurrency}} </p>
                                            <p *ngIf="item.product.dis>0"> {{item.product.dis | currency:userCurrency}}</p>
                                        </td>
                                        <td>
                                            <p>&nbsp; {{item.qty}} </p>
                                        </td>
                                        <td [hidden]="item.product.dis>0">
                                            <p>{{item.product.price* item.qty | currency:userCurrency}}</p>
                                        </td>
                                        <td [hidden]="item.product.dis<=0">
                                            <p>{{item.product.dis* item.qty | currency:userCurrency}}</p>
                                        </td>
                                        <td><i class="fa fa-minus" (click)="deleteItem(item)"></i></td>
                                    </tr>
                                </ng-container>
                            </tbody>
                        </table>
                        <div>
                            <div class="half">
                                <p>優惠碼</p>
                                <div>
                                    <input type="text" class="uppercase" (change)="applyCode()" #cashCode>
                                    <button (click)="applyCode()"> <span> 確認優惠碼 </span>
                    <div class="loader" *ngIf="loading">
                      <span></span><span></span><span></span><span></span><span></span>
                    </div>
                  </button>
                                    <p class="info">{{message}}</p>
                                </div>
                            </div>
                            <div class="half">
                                <p>小計: {{subtotal()| currency:userCurrency}} </p>
                                <p class="strong">
                                    <span *ngIf="promoBonus&&promoBonus.discount">{{promoBonus.discount}} Off</span>
                                    <span *ngIf="promoBonus"> {{promoBonus.amount| currency:userCurrency}}</span>
                                </p>
                                <h4>預估總計: {{total()| currency:userCurrency}} </h4>
                                <p class="info">運費和稅費在結算時計算.</p>
                            </div>
                        </div>
                        <div>
                            <div class="half">
                                <a class="nextBtn" [routerLink]="['/tc/home']">繼續購物</a>
                            </div>
                            <div class=" half ">
                                <button [hidden]="!logined " class="nextBtn crimson " (click)="goToShipping() ">&nbsp;結算&nbsp;</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="body-right " *ngIf="!logined ">
                    <h3>結算</h3>
                    <div>
                        <h4>已經是會員</h4>
                        <span>登錄以後結算，方便您的購物流程.</span>
                        <div class="text-center btn-box">
                            <a class="nextBtn crimson " [routerLink]="[ '/tc/register'] " [queryParams]="{returnUrl: '/en/checkout/mycart'} ">登錄</a>
                        </div>
                    </div>
                    <div>
                        <h4>新用戶</h4>
                        <span>以遊客身份結算. Your personal data will help us create your account and to support your user
              experience throughout this website.</span>
                        <div class="text-center btn-box">
                            <a class="nextBtn" (click)="goToShipping() ">遊客結算</a>
                        </div>
                    </div>

                </div>
            </div>
        </ng-container>
        <ng-template #noItems>
            <div class="body-flex text-center " [ngClass]="{ 'full': logined} ">
                <div>
                    <h3>購物車為空</h3>
                    <a [routerLink]="['/tc/home']" class="nextBtn ">繼續購物</a>
                    <div class="flex ">
                        <div class="box ">
                            <img src="assets/images/snap-s.jpg " alt=" " class="img-responsive ">
                            <br> <br>
                            <a [routerLink]="['/tc/products/women/all']">女裝</a>
                        </div>
                        <div class="box ">
                            <img src="assets/images/men-1.jpg " alt=" " class="img-responsive ">
                            <br> <br>
                            <a [routerLink]="['/tc/products/men/all']">男裝</a>
                        </div>
                        <div class="box ">
                            <img src="assets/images/snap-s.jpg " alt=" " class="img-responsive ">
                            <br> <br>
                            <a [routerLink]="['/tc/products/accessories/all']">飾物</a>
                        </div>
                    </div>
                </div>
            </div>
        </ng-template>
    </div>
</section>